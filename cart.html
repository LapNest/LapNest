<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="css/nav.css" />
    <link rel="stylesheet" href="css/cart.css" />
    <title>cart</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg sticky-top bgc">
      <div class="container-fluid">
        <img src="Lapnest.png" alt="icon" class="icon" />
        <a class="navbar-brand" href="#">
          <div class="container-fluid">
            <img
              src="name.png"
              alt="Lapnest"
              id="name"
              width="150px"
              height="auto"
            />
          </div>
        </a>
        <button
          class="navbar-toggler menubtn"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav ms-auto">
            <a
              class="nav-link active text-white item0"
              aria-current="page"
              href="home.html"
              >Home</a
            >
            <a
              class="nav-link active text-white item0"
              aria-current="page"
              href="shop.html"
              >Shop</a
            >
            <a
              class="nav-link active text-white item0"
              aria-current="page"
              href="cart.html"
              >Cart
            </a>
            <a
              class="nav-link active text-white item0"
              aria-current="page"
              href="contact.html"
              >Contact</a
            >
          </div>
        </div>
      </div>
    </nav>

    <div class="container c0">
      <h2>Cart</h2>
      <hr />
      <div class="c1" id="cartItems"></div>
      <a
        id="pto"
        class="btn btn-primary"
        data-bs-toggle="collapse"
        href="#def"
        role="button"
        aria-expanded="false"
        aria-controls="collapseExample"
      >
        Place Order
      </a>
      <div id="def" class="collapse">
        <div class="card card-body">
          <h3>Enter your details</h3>
          <form
            id="orderForm"
            action="https://script.google.com/macros/s/AKfycbwcM76CRAHtX0U4bo-SMZs1rOIeP6ROU0tJMycrImp2Tt4VpY38RwpclqsaITI9Yu_N/exec"
            method="post"
          >
            <div class="mb-3">
              <label for="name" class="form-label">Name:</label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                required
              />
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email:</label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                required
              />
            </div>
            <div class="mb-3">
              <label for="phone" class="form-label">Phone Number:</label>
              <input
                type="tel"
                class="form-control"
                id="phone"
                name="phone"
                required
              />
            </div>
            <div class="mb-3">
              <label for="orders" class="form-label">Orders:</label>
              <textarea
                class="form-control"
                id="orders"
                name="orders"
                rows="3"
                readonly
                required
              ></textarea>
            </div>
            <button type="submit" id="i1" class="btn btn-primary">Place</button>
          </form>
        </div>
      </div>
    </div>
    <script>
      const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
      function generateProductCard(product) {
        return `
        <div class="card mb-3">
          <div class="card-body">
            <div class="row c3">
              <div class="col-lg-4 col-md-8 col-sm-12 pic">
                <img src="companies/${product.cm}.webp" alt="" />
              </div>
              <div class="col-lg-8 col-md-6 col-sm-12 info">
                <h5 class="card-title">${product.name}</h5>
                <p class="card-text xyz">Quantity : ${product.quantity} </p>
                <p class="card-text">Price: ${product.price}</p>
              </div>
            </div>
          </div>
        </div>
        `;
      }

      function renderProductCards() {
        const cartItemsContainer = document.getElementById("cartItems");
        cartItemsContainer.innerHTML = "";

        cartItems.forEach((item) => {
          const cardHtml = generateProductCard(item);
          cartItemsContainer.innerHTML += cardHtml;
        });
      }

      // Render product cards when the page loads
      window.addEventListener("DOMContentLoaded", renderProductCards);

      function generateOrdersString() {
        const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
        let ordersString = "";
        cartItems.forEach((item) => {
          ordersString += `Name : ${item.name}\n Quantity : ${item.quantity}\n`;
        });
        return ordersString.trim(); // Remove trailing newline
      }

      document.getElementById("orders").value = generateOrdersString();

      let form = document.querySelector("form");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        fetch(form.action, {
          method: "POST",
          body: new FormData(document.getElementById("orderForm")),
        })
          .then((response) => {
            // Check if the response is successful before opening the cart page
            if (response.ok) {
              console.log("IH");
              window.open("home.html", "_self");
            } else {
              // Handle errors if necessary
              alert("HI;");
              console.error("Error submitting form:", response.statusText);
            }
          })
          .catch((error) => {
            alert("byf");
            console.error("Error submitting form:", error);
          });
      });
    </script>
  </body>
</html>
